<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLHO Vanilla • mlho</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MLHO Vanilla">
<meta property="og:description" content="mlho">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mlho</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MLHO_Vanilla.html">MLHO Vanilla</a>
    </li>
    <li>
      <a href="../articles/MLHO_for_PheWAS.html">Multivariate PheWAS with MLHO</a>
    </li>
    <li>
      <a href="../articles/PASC-analysis.html">PASC analysis</a>
    </li>
    <li>
      <a href="../articles/modeling_with_4CE_severity_codes.html">modeling with 4CE severity codes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hestiri/mlho/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MLHO_Vanilla_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="MLHO_Vanilla_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/datatables-binding-0.21/datatables.js"></script><link href="MLHO_Vanilla_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="MLHO_Vanilla_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="MLHO_Vanilla_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="MLHO_Vanilla_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/selectize-0.12.0/selectize.min.js"></script><link href="MLHO_Vanilla_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MLHO Vanilla</h1>
                        <h4 data-toc-skip class="author">Hossein Estiri</h4>
            
            <h4 data-toc-skip class="date">Nov. 5th 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hestiri/mlho/blob/HEAD/vignettes/MLHO_Vanilla.Rmd" class="external-link"><code>vignettes/MLHO_Vanilla.Rmd</code></a></small>
      <div class="hidden name"><code>MLHO_Vanilla.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make sure the package is installed --&gt; devtools::install_github("hestiri/mlho")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hestiri/mlho" class="external-link">mlho</a></span><span class="op">)</span></code></pre></div>
<p>Install and load the required packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/pacman" class="external-link">pacman</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: pacman</span>

<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">data.table</span>, <span class="va">devtools</span>, <span class="va">backports</span>, <span class="va">Hmisc</span>, <span class="va">tidyr</span>,<span class="va">dplyr</span>,<span class="va">ggplot2</span>,<span class="va">plyr</span>,<span class="va">scales</span>,<span class="va">readr</span>,
               <span class="va">httr</span>, <span class="va">DT</span>, <span class="va">lubridate</span>, <span class="va">tidyverse</span>,<span class="va">reshape2</span>,<span class="va">foreach</span>,<span class="va">doParallel</span>,<span class="va">caret</span>,<span class="va">gbm</span>,<span class="va">lubridate</span>,<span class="va">praznik</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="mlho-vanilla-implementation">MLHO Vanilla implementation<a class="anchor" aria-label="anchor" href="#mlho-vanilla-implementation"></a>
</h2>
<p>Here we go through the vanilla implementation of MLHO using the synthetic data provided in the package.</p>
<p>The synthetic data <code>syntheticmass</code> downloaded and prepared according to MLHO input data model from <a href="https://synthea.mitre.org/downloads" class="external-link">SyntheticMass</a>, generated by <a href="https://synthetichealth.github.io/synthea/" class="external-link">SyntheaTM</a>, an open-source patient population simulation made available by <a href="https://health.mitre.org/" class="external-link">The MITRE Corporation</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"syntheticmass"</span><span class="op">)</span></code></pre></div>
<p>here’s how <code>dbmart</code> table looks (there’s an extra column that is the translation of the <code>phenx</code> concepts):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">)</span>
<span class="co">#&gt;                            patient_num     phenx</span>
<span class="co">#&gt; 1 8d4c4326-e9de-4f45-9a4c-f8c36bff89ae 169553002</span>
<span class="co">#&gt; 2 10339b10-3cd1-4ac3-ac13-ec26728cb592 430193006</span>
<span class="co">#&gt; 3 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 430193006</span>
<span class="co">#&gt; 4 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 117015009</span>
<span class="co">#&gt; 5 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 117015009</span>
<span class="co">#&gt; 6 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 430193006</span>
<span class="co">#&gt;                               DESCRIPTION          start_date</span>
<span class="co">#&gt; 1 Insertion of subcutaneous contraceptive 2011-04-30 00:26:23</span>
<span class="co">#&gt; 2   Medication Reconciliation (procedure) 2010-07-27 12:58:08</span>
<span class="co">#&gt; 3   Medication Reconciliation (procedure) 2010-11-20 03:04:34</span>
<span class="co">#&gt; 4              Throat culture (procedure) 2011-02-07 03:04:34</span>
<span class="co">#&gt; 5              Throat culture (procedure) 2011-04-19 03:04:34</span>
<span class="co">#&gt; 6   Medication Reconciliation (procedure) 2011-11-26 03:04:34</span></code></pre></div>
<p>our demographic table contains: patient_num, white, black, hispanic, sex_cd.</p>
<p>##split data into train-test</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uniqpats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#using a 70-30 ratio</span>
<span class="va">test_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">uniqpats</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">uniqpats</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">test_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">labeldt</span>,<span class="va">labeldt</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"test set lables:"</span><span class="op">)</span>
<span class="co">#&gt; [1] "test set lables:"</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">test_labels</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   0   1 </span>
<span class="co">#&gt; 261  90</span>
<span class="va">train_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">labeldt</span>,<span class="op">!</span><span class="op">(</span><span class="va">labeldt</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"train set lables:"</span><span class="op">)</span>
<span class="co">#&gt; [1] "train set lables:"</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">train_labels</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   0   1 </span>
<span class="co">#&gt; 593 227</span>
<span class="co"># train and test sets </span>
<span class="va">dat.train</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dbmart</span>,<span class="op">!</span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dbmart</span>,<span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>now dimensionality reduction on training set ## MSMR lite from here, we will split the data into a train and a test set and apply <code>MSMR.lite</code> to the training data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">)</span>
<span class="va">dat.train</span><span class="op">[</span>,<span class="va">row</span> <span class="op">:=</span> <span class="va">.I</span><span class="op">]</span>
<span class="va">dat.train</span><span class="op">$</span><span class="va">value.var</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">uniqpats.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">##here is the application of MSMR.lite</span>
<span class="va">dat.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSMSR.lite.html">MSMSR.lite</a></span><span class="op">(</span>MLHO.dat<span class="op">=</span><span class="va">dat.train</span>,
                        patients <span class="op">=</span> <span class="va">uniqpats.train</span>,
                        sparsity<span class="op">=</span><span class="fl">0.005</span>, 
                        labels <span class="op">=</span> <span class="va">labeldt</span>,
                        topn<span class="op">=</span><span class="fl">200</span><span class="op">)</span>
<span class="co">#&gt; [1] "step - 1: sparsity screening!"</span>
<span class="co">#&gt; [1] "step 2: JMI dimensionality reduction!"</span></code></pre></div>
<p>Notice that we are removing concepts that had prevalence less than 0.5% and then only taking the top 200 after the JMI rankings. See help (<code><a href="../reference/MSMSR.lite.html">?mlho::MSMSR.lite</a></code>) for <code>MSMR.lite</code> parameters.</p>
<p>Now we have the training data with the top 200 features, to which we can add demographic features. Now on to prepping the test set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat.test</span>,<span class="va">dat.test</span><span class="op">$</span><span class="va">phenx</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">)</span><span class="op">)</span>
<span class="fu">setDT</span><span class="op">(</span><span class="va">dat.test</span><span class="op">)</span>
<span class="va">dat.test</span><span class="op">[</span>,<span class="va">row</span> <span class="op">:=</span> <span class="va">.I</span><span class="op">]</span>
<span class="va">dat.test</span><span class="op">$</span><span class="va">value.var</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">uniqpats.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat.test</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSMSR.lite.html">MSMSR.lite</a></span><span class="op">(</span>MLHO.dat<span class="op">=</span><span class="va">dat.test</span>,patients <span class="op">=</span> <span class="va">uniqpats.test</span>,sparsity<span class="op">=</span><span class="cn">NA</span>,jmi <span class="op">=</span> <span class="cn">FALSE</span>,labels <span class="op">=</span> <span class="va">labeldt</span><span class="op">)</span></code></pre></div>
<p>Here notice that we only used <code>MSMR.lite</code> to generate the wide table that matches to the <code>dat.train</code> table.</p>
<p>##Modeling we will use the <code>mlearn</code> function to do the modeling, which includes training the model and testing it on the test set.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlearn.html">mlearn</a></span><span class="op">(</span><span class="va">dat.train</span>,
                   <span class="va">dat.test</span>,
                   dems<span class="op">=</span><span class="va">dems</span>,
                   save.model<span class="op">=</span><span class="cn">FALSE</span>,
                   classifier<span class="op">=</span><span class="st">"gbm"</span>,
                   note<span class="op">=</span><span class="st">"mlho_terst_run"</span>,
                   cv<span class="op">=</span><span class="st">"cv"</span>,
                   nfold<span class="op">=</span><span class="fl">5</span>,
                   aoi<span class="op">=</span><span class="st">"prediabetes"</span>,
                   multicore<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] "the modeling!"</span>
<span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span>
<span class="co">#&gt;      1        1.0611             nan     0.1000    0.0571</span>
<span class="co">#&gt;      2        0.9674             nan     0.1000    0.0440</span>
<span class="co">#&gt;      3        0.8988             nan     0.1000    0.0341</span>
<span class="co">#&gt;      4        0.8394             nan     0.1000    0.0298</span>
<span class="co">#&gt;      5        0.7898             nan     0.1000    0.0245</span>
<span class="co">#&gt;      6        0.7477             nan     0.1000    0.0194</span>
<span class="co">#&gt;      7        0.7105             nan     0.1000    0.0164</span>
<span class="co">#&gt;      8        0.6808             nan     0.1000    0.0140</span>
<span class="co">#&gt;      9        0.6560             nan     0.1000    0.0121</span>
<span class="co">#&gt;     10        0.6345             nan     0.1000    0.0095</span>
<span class="co">#&gt;     20        0.5234             nan     0.1000    0.0025</span>
<span class="co">#&gt;     40        0.4479             nan     0.1000   -0.0004</span>
<span class="co">#&gt;     50        0.4252             nan     0.1000   -0.0010</span>
<span class="co">#&gt; Loading required package: pROC</span>
<span class="co">#&gt; Type 'citation("pROC")' for a citation.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'pROC'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     cov, smooth, var</span>
<span class="co">#&gt; Loading required package: PRROC</span>
<span class="co">#&gt; Loading required package: ModelMetrics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ModelMetrics'</span>
<span class="co">#&gt; The following object is masked from 'package:pROC':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     auc</span>
<span class="co">#&gt; The following objects are masked from 'package:caret':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     confusionMatrix, precision, recall, sensitivity, specificity</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     kappa</span>
<span class="co">#&gt; Setting levels: control = N, case = Y</span>
<span class="co">#&gt; Setting direction: controls &lt; cases</span></code></pre></div>
<p>try <code><a href="../reference/mlearn.html">?mlho::mlearn</a></code> to learn more about <code>mlearn</code> parameters.</p>
<p>you can select a variety of models. For binray classification tasks, chose from:ORFlog, RRF,gbm,bayesglm,regLogistic,xgbDART,regLogistic, glmnet, bayesglm, nb, svmRadialWeights,avNNet,and ordinalRF. see the list and description of all available <a href="https://rdrr.io/cran/caret/man/models.html" class="external-link">models</a></p>
</div>
<div class="section level2">
<h2 id="mlearn-outputs">
<code>mlearn</code> outputs<a class="anchor" aria-label="anchor" href="#mlearn-outputs"></a>
</h2>
<p>outputs of <code>mlearn</code> include:</p>
<ul>
<li>model performance metrics: <code>model.test$ROC</code>
<ul>
<li>in model.test AUROC is 0.9392964</li>
</ul>
</li>
<li>final important features, which can be pulled and save from <code>model.test$features</code>
</li>
<li>absolute errors for each patients using <code>model.test$AE</code>
</li>
<li>missing important features <code>model.test$missing.features</code>
</li>
</ul>
<p>For instance, only the following 32 features were used in phenotyping the <code>prediabetes</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.test</span><span class="op">$</span><span class="va">features</span>
<span class="co">#&gt;         Overall        features classifier         aoi</span>
<span class="co">#&gt; 5     0.3136170          197604        gbm prediabetes</span>
<span class="co">#&gt; 12    0.3235465          310325        gbm prediabetes</span>
<span class="co">#&gt; 14    0.1539752          310798        gbm prediabetes</span>
<span class="co">#&gt; 19    1.0037857          314231        gbm prediabetes</span>
<span class="co">#&gt; 20    0.3415622          429503        gbm prediabetes</span>
<span class="co">#&gt; 25    0.4411857          746030        gbm prediabetes</span>
<span class="co">#&gt; 34    2.9403691          860975        gbm prediabetes</span>
<span class="co">#&gt; 35    0.7740851          895994        gbm prediabetes</span>
<span class="co">#&gt; 41    0.2456665          999967        gbm prediabetes</span>
<span class="co">#&gt; 56    1.0986762         2001499        gbm prediabetes</span>
<span class="co">#&gt; 58    2.0757288         5880005        gbm prediabetes</span>
<span class="co">#&gt; 61    2.7231739        14768001        gbm prediabetes</span>
<span class="co">#&gt; 64    7.3031171        19169002        gbm prediabetes</span>
<span class="co">#&gt; 68    1.7556961        28163009        gbm prediabetes</span>
<span class="co">#&gt; 73    0.4680127        44054006        gbm prediabetes</span>
<span class="co">#&gt; 90    0.2529442        66348005        gbm prediabetes</span>
<span class="co">#&gt; 95    2.6082006        73761001        gbm prediabetes</span>
<span class="co">#&gt; 98    0.3294569        76601001        gbm prediabetes</span>
<span class="co">#&gt; 99    0.2574582        79586000        gbm prediabetes</span>
<span class="co">#&gt; 106   0.5951390       104091002        gbm prediabetes</span>
<span class="co">#&gt; 112   0.3500893       117015009        gbm prediabetes</span>
<span class="co">#&gt; 123   0.6573163       169230002        gbm prediabetes</span>
<span class="co">#&gt; 125   0.3098779       171207006        gbm prediabetes</span>
<span class="co">#&gt; 132   1.4529787       225158009        gbm prediabetes</span>
<span class="co">#&gt; 137   1.0982878       237602007        gbm prediabetes</span>
<span class="co">#&gt; 139   0.8168777       239873007        gbm prediabetes</span>
<span class="co">#&gt; 147 100.0000000       271737000        gbm prediabetes</span>
<span class="co">#&gt; 180   2.0730375       430193006        gbm prediabetes</span>
<span class="co">#&gt; 181   0.3051240       431855005        gbm prediabetes</span>
<span class="co">#&gt; 197   0.3094696       703423002        gbm prediabetes</span>
<span class="co">#&gt; 200   0.2727734 368581000119106        gbm prediabetes</span>
<span class="co">#&gt; 202   0.2682787           black        gbm prediabetes</span></code></pre></div>
<p><em>we recommend iterating the training and testing and storing the coefficients in a directory.</em></p>
</div>
<div class="section level2">
<h2 id="visualizing-the-outputs">Visualizing the outputs<a class="anchor" aria-label="anchor" href="#visualizing-the-outputs"></a>
</h2>
<p>Here we create a plot of the feature importance scores for each of the top (here we have ) predictors identified by MLHO.</p>
<p>To do so, let’s map the concept codes to their “English” translation. <em>That’s why we kept that 4th column called <code>description</code> in <code>dbmart</code>.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbmart.concepts</span> <span class="op">&lt;-</span> <span class="va">dbmart</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">phenx</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"phenx"</span>,<span class="st">"DESCRIPTION"</span><span class="op">)</span><span class="op">]</span>
<span class="va">mlho.features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">model.test</span><span class="op">$</span><span class="va">features</span>,<span class="va">dbmart.concepts</span>,by.x<span class="op">=</span><span class="st">"features"</span>,by.y <span class="op">=</span> <span class="st">"phenx"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">datatable</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mlho.features</span>,<span class="va">features</span>,<span class="va">DESCRIPTION</span>,`Feature importance`<span class="op">=</span><span class="va">Overall</span><span class="op">)</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, filter <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-b208bf01a3628b27c209" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b208bf01a3628b27c209">{"x":{"filter":"bottom","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.153975180586265\" data-max=\"100\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],["104091002","117015009","14768001","169230002","171207006","19169002","197604","2001499","225158009","237602007","239873007","271737000","28163009","310325","310798","314231","368581000119106","429503","430193006","431855005","44054006","5880005","66348005","703423002","73761001","746030","76601001","79586000","860975","895994","999967"],["Hemoglobin / Hematocrit / Platelet count","Throat culture (procedure)","Peripheral blood smear interpretation","Ultrasound scan for fetal viability","Depression screening","Miscarriage in first trimester","Digoxin 0.125 MG Oral Tablet","Vitamin B 12 5 MG/ML Injectable Solution","Auscultation of the fetal heart","Metabolic syndrome X (disorder)","Osteoarthritis of knee","Anemia (disorder)","Skin test for tuberculosis","ferrous sulfate 325 MG Oral Tablet","Hydrochlorothiazide 25 MG Oral Tablet","Simvastatin 10 MG Oral Tablet","Neuropathy due to type 2 diabetes mellitus (disorder)","Hydrochlorothiazide 12.5 MG","Medication Reconciliation (procedure)","Chronic kidney disease stage 1 (disorder)","Diabetes","Physical examination of mother","Childbirth","Combined chemotherapy and radiation therapy (procedure)","Colonoscopy","Atenolol 50 MG / Chlorthalidone 25 MG Oral Tablet","Intramuscular injection","Tubal pregnancy","24 HR Metformin hydrochloride 500 MG Extended Release Oral Tablet","120 ACTUAT Fluticasone propionate 0.044 MG/ACTUAT Metered Dose Inhaler","amLODIPine 5 MG / Hydrochlorothiazide 12.5 MG / Olmesartan medoxomil 20 MG Oral Tablet"],[0.595138984458977,0.350089321967607,2.72317392702416,0.657316315359661,0.309877880198119,7.30311709726128,0.313617011216061,1.09867615065585,1.45297873238938,1.09828784895972,0.816877699645141,100,1.75569613988148,0.323546484549321,0.153975180586265,1.00378566545359,0.272773350408933,0.341562161640932,2.07303748444174,0.305124029106228,0.468012724875347,2.07572875056071,0.252944156930217,0.309469583814712,2.60820058687088,0.44118567388443,0.329456862208838,0.257458232311738,2.94036905627009,0.774085070599917,0.245666492316129]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>features<\/th>\n      <th>DESCRIPTION<\/th>\n      <th>Feature importance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>now visualizing feature importance</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">plot</span><span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">mlho.features</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_segment</span><span class="op">(</span>
      <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span>,
          x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">DESCRIPTION</span>,<span class="va">Overall</span><span class="op">)</span>,
          yend <span class="op">=</span> <span class="va">Overall</span>,
          xend <span class="op">=</span> <span class="va">DESCRIPTION</span><span class="op">)</span>,
      size<span class="op">=</span><span class="fl">0.5</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>
      <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">DESCRIPTION</span>,<span class="va">Overall</span><span class="op">)</span>,y<span class="op">=</span><span class="va">Overall</span><span class="op">)</span>,
      alpha<span class="op">=</span><span class="fl">0.5</span>,size<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
   <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span><span class="st">"Feature importance"</span>,x<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MLHO_Vanilla_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="notes-for-more-complex-implementation">Notes for more complex implementation<a class="anchor" aria-label="anchor" href="#notes-for-more-complex-implementation"></a>
</h2>
<p>As we recommended above, it’s best to at least iterate the training process 5 times, in which case you’ll have 5 files containing the important features from MLHO. We do this regularly. If you do so, you can compute the mean/median values for each feature.</p>
<p>Now if you want to get the regression coefficients and compute Odds Ratios (ORs), you can then select the top feature that were selected most frequently in MLHO iterations to run a regression model (pass <code>glm</code> to <code>mlearn</code>) and extract regression coefficients to then transform to ORs.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hossein Estiri.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
